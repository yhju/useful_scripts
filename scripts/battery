#!/bin/bash
#AUTHOR: Younghun Ju <yhju@yujinrobot.comm>, <yhju83@gmail.com>

# 1. Laptop Battery
# check for existence of /proc/acpi/battery/BAT? directories
BAT_PREFIX=/proc/acpi/battery
if [ -e $BAT_PREFIX/BAT0 ]; then BAT=BAT0; fi
if [ -e $BAT_PREFIX/BAT1 ]; then BAT=BAT1; fi

REMAIN="$(cat $BAT_PREFIX/$BAT/state | grep remaining | awk '{print $3}')"
FULL="$(cat $BAT_PREFIX/$BAT/info  | grep last | awk '{print $4}')"

#echo $REMAIN
#echo $FULL
RATE="$(echo "scale=2; 100*$REMAIN/$FULL" | bc)"
echo Laptop: $RATE%


# 2. Robot Battery
# check for presence of robot
TOPIC=/mobile_base/sensors/core

if ! rostopic info $TOPIC > /dev/null 2>&1; then
#echo "robot is not loaded yet."
  exit
fi

VAL="$(rostopic echo -n 1 $TOPIC | grep battery | awk '{print $2}')"
VOLT="$(echo "scale=4; $VAL*0.1" | bc)"

echo Robot: $VOLT'V'
